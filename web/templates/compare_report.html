<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Solo vs Pool Comparison</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/site.css?v=2.1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="bg-body">
  <div class="container container-narrow py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">Solo vs Pool Risk Comparison</h1>
      <div class="d-flex gap-3">
        <a href="/" class="link-secondary">Home</a>
        <a href="/methods" class="link-secondary">Methods</a>
        <a href="/compare" class="link-secondary">New compare</a>
      </div>
    </div>

    <div class="card p-3 mb-4">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="small text-body-secondary">Coin</div>
          <div class="fw-semibold">{{ result.input.coin|upper }}</div>
        </div>
        <div class="col-md-4">
          <div class="small text-body-secondary">Hashrate</div>
          <div class="fw-semibold">{{ result.input.hashrate_display }}</div>
        </div>
        <div class="col-md-4">
          <div class="small text-body-secondary">Horizon (days)</div>
          <div class="fw-semibold">{{ result.input.horizon_days }}</div>
        </div>

        <div class="col-md-4">
          <div class="small text-body-secondary">Coin price (USD)</div>
          <div class="fw-semibold">{{ '%.2f'|format(result.input.coin_price_usd) }}</div>
        </div>
        <div class="col-md-4">
          <div class="small text-body-secondary">Electricity ($/kWh)</div>
          <div class="fw-semibold">{{ '%.4f'|format(result.input.electricity_cost_per_kwh) }}</div>
        </div>
        <div class="col-md-4">
          <div class="small text-body-secondary">ASIC power (watts)</div>
          <div class="fw-semibold">{{ result.input.asic_power_watts }}</div>
        </div>

        <div class="col-md-4">
          <div class="small text-body-secondary">Pool fee</div>
          <div class="fw-semibold">{{ '%.3f'|format(result.input.pool_fee_pct) }}</div>
        </div>
        <div class="col-md-4">
          <div class="small text-body-secondary">Monte Carlo runs</div>
          <div class="fw-semibold">{{ result.input.mc_runs }}</div>
        </div>
      </div>
    </div>

    <div id="results">
      <div class="alert alert-warning fw-semibold" id="regret-alert"></div>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="card p-3">
            <h2 class="h6">Solo</h2>
            <div id="solo-results"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card p-3">
            <h2 class="h6">Pool</h2>
            <div id="pool-results"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card p-3 mt-3">
      <div class="d-flex flex-wrap align-items-center gap-2">
        <strong>Share link:</strong>
        <span class="share-box flex-grow-1">
          <a href="/c/{{ token }}">/c/{{ token }}</a>
        </span>
        <button id="copy-existing" class="btn btn-outline-secondary btn-sm" type="button">Copy</button>
        <span id="copy-existing-status" class="small text-body-secondary"></span>
      </div>
    </div>

    <div class="row g-3 mt-2">
      <div class="col-lg-6">
        <div class="card p-3">
          <h2 class="h6">Solo net outcomes (USD)</h2>
          <canvas id="soloNetHist"></canvas>
          <div class="small text-body-secondary mt-2">
            Bars show probability mass per net-$ bucket.
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card p-3">
          <h2 class="h6">Delta vs pool (Solo − Pool, USD)</h2>
          <canvas id="deltaHist"></canvas>
          <div class="small text-body-secondary mt-2">
            Left of 0 = solo underperforms pool.
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
(function () {
  const shareStatus = document.getElementById('copy-existing-status');
  const copyBtn = document.getElementById('copy-existing');

  function render(data) {
    const regret = data.comparison.probability_solo_underperforms_pool;
    const regretPct = (regret * 100).toFixed(1);
    document.getElementById('regret-alert').innerText =
      `Probability solo underperforms pool: ${regretPct}%`;

    document.getElementById('solo-results').innerHTML = `
      <div>Expected net: $${data.solo.expected_net_usd.toFixed(2)}</div>
      <div>P10 net: $${data.solo.p10_net_usd.toFixed(2)}</div>
      <div>P50 net: $${data.solo.p50_net_usd.toFixed(2)}</div>
      <div>P90 net: $${data.solo.p90_net_usd.toFixed(2)}</div>
      <div>Probability negative net: ${(data.solo.probability_negative_net*100).toFixed(1)}%</div>
      <div>Probability zero blocks: ${(data.solo.probability_zero_blocks*100).toFixed(1)}%</div>
    `;

    document.getElementById('pool-results').innerHTML = `
      <div>Expected net: $${data.pool.expected_net_usd.toFixed(2)}</div>
    `;
  }

  const data = {{ result|tojson }};
  render(data);

  if (copyBtn) {
    copyBtn.addEventListener('click', async () => {
      const url = `${window.location.origin}/c/{{ token }}`;
      try {
        await navigator.clipboard.writeText(url);
        shareStatus.textContent = 'Copied.';
        setTimeout(() => { shareStatus.textContent = ''; }, 1500);
      } catch (e) {
        window.prompt('Copy this link:', url);
      }
    });
  }
})();
</script>
<script>
(function () {
  const data = {{ result|tojson }};

  function buildBarConfig(hist, title) {
    const bins = hist.bins || [];
    const prob = hist.prob || [];
    const labels = bins.map(v => v.toFixed(0));
    return {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: title,
          data: prob
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `P ≈ ${(ctx.raw * 100).toFixed(2)}%`
            }
          }
        },
        scales: {
          x: { ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 10 } },
          y: { beginAtZero: true, ticks: { callback: (v) => (v * 100).toFixed(0) + '%' } }
        }
      }
    };
  }

  const soloHist = data.distributions.solo_net_usd;
  const deltaHist = data.distributions.delta_vs_pool_usd;

  new Chart(document.getElementById('soloNetHist'), buildBarConfig(soloHist, 'Solo net (USD)'));
  new Chart(document.getElementById('deltaHist'), buildBarConfig(deltaHist, 'Delta vs pool (USD)'));
})();
</script>

</body>
</html>